# Angular勉強

## モダンWebについて  
### モダンWeb  
**画面表示待ちの時間**や**オフラインでの利用不可の不便さ**や**従来のサーバー集中処理**を解決するために、ブラウザ側でサーバーで処理していた**画面生成**や**データ処理**等の処理を分散するシステムです。  
これによって、  

1. サーバーとの通信頻度の減少
	- インフラコストの削減
2. ブラウザ内にデータとプログラムを保存できる
	- オフラインでの利用が可能  
	- 通信待ちのない高速な画面遷移  
3. ブラウザ内でデータ処理ができる
	- 処理結果をすぐに返すことができる   
4. 無限スクロールなどの新機能を追加できる
※これについてはもう少し調べてみます。。
といったメリットがあります。  

※以上は齋藤さんが勉強会で話した内容と重なる部分がありますが何がモダンWebであるのかも含めて自分の中の理解を深める意味で調べてみました。

## モダンWeb開発のハードル  
### 開発における3つのハードル  
1. 学習コストが高い  
JavaScriptについてはJavaScript特有のオブジェクト指向の実装が必要なため新たに基礎から学習する必要がある。

2. 開発生産性が低い  
Java8では動作検証が行われた4000個以上のクラスが提供されていて、必要な機能は標準ライブラリを使って簡単に実装できるのに対し、JavaScriptには標準ライブラリが存在していません。

3. チーム開発に対応する機能がない  
名前空間やソースコードの分割といったチーム開発に必要な機能が標準でされていない。

### 上記のハードルをAngularが解消してくれる4つの理由

1. 学習コストを下げる
Javaなどの文法を踏襲したTypeScriptを採用しているので開発経験者はこれまでの知識を活かせる
※僕の場合はそういった知識が乏しいのでこのあたりはこれから身につけていかなきゃなと思いました

2. 高速開発が可能
アプリ開発に必要な機能がフレームワークとして準備されている

3. チーム開発に対応する機能が充実している
名前空間やソースコードの分割といったチーム開発に必要な機能が提供されている

4. 開発ツールの統合と自動化
`Angular CLI`が、新規プロジェクトの生成や開発時の繰り返し作業(ソースコードのビルド・実行・動作確認)を複数ツールを結合して1コマンドで自動実行してくれる

## Angularの特徴  
### コンポーネント  
画面部品に対する分割のこと。  
部品化することで同じ表示部分をもつ別画面での再利用や、複雑な機能を分割することができるので開発作業の重複を最小限にして、分割した機能をチームで分割して開発が進められる利点があります。HTMLがないComponentは `Directive`と言う。

### ディレクティブ
ディレクティブはHTMLがないコンポーネントのこと。
コンポーネントとの違いとしては、  
- コンポーネントは、部品（HTMLを含めた）の実装をする時  
- ディレクティブは、機能の実装をする時  
`memo`:  
`部品`をつなげ合わせるとウェブサイトができる。その `部品`内にも機能をつけることができるが、各部品に `機能`を付与したりもできる。(齋藤さん引用)  

### Service  
アプリの共通処理を行うものです。コンポーネントは画面が切り替わるたびにインスタンスが破棄されるため画面間のデータの受け渡しができませんが、サービスは全体共有データを保持させることができます。ただしリロードでデータが消失する。それが不都合な場合は`SessionStorage`　　の使用を検討する。  
これについてはDI(依存性注入)が絡んでくるのでそれはこれから調べます。

### Routing
ルーティングはSinglePageApplicationを実装する上では欠かせない仕組みで、URLに応じてコンテンツの部分を動的に表示させる仕組みのこと。 

### DI(Dependency Injection)-依存性の注入
functionにオブジェクトを渡すこと。  
オブジェクトを`function`の中で生成するのではなく`funchtion`に引数として渡してあげる。

## Angularのテスト作業の自動化について  
・ブラウザ上の単体テストではKarma  
・ブラウザ操作のシミュレーションを行うE2Eテスト用にProtractor  
両方ともAngulaerCLIコマンドでインストールとテストの実行ができる。


## 分散処理への対応について  
従来はブラウザに保持するデータはCookieくらいでブラウザ側での処理はほとんど考える必要がなかったが、分散処理ではローカルデータベースが利用できるのでWebサーバーのデータベースとの役割分担、データの消失防止策の検討が必要。  
### ローカルデータベースの位置付け  
サーバーのデータベースとローカルのデータベース両方で変更が起きた場合はデータのマージ処理やユーザーの確認が必要になっていき運用が煩雑になってしまう。  
また、使用しているPCやモバイルデバイスの紛失・故障が起きるとデータが消えてしまう。  
それを以下の手順でローカルデータベースの役割を**サーバーデータベース**として位置付けて解消する。

1. サーバーデータベースから定期的にデータをダウンロードして、ローカルデータベースにコピー  
2. Angularアプリはローカルデータベースからデータを読み取り、分散処理を実行する
3. データの新規入力や変更を行った場合は、その都度サーバーへアップロードして、サーバーデータベースを更新  
4. 例外として、ネットワーク圏外でアップロードができない場合はローカルデータベースに一時保管、通信可能になった時点で再アップロードする

## HTMLテンプレートの制限事項
1. HTMLの制限
script/html/body/baseのHTML要素は使えない

2. テンプレートシンタックスの制限
- ブラウザのグローバルスコープのオブジェクト(windowやdocumentなど)は利用できない
- 以下の演算子が利用できない  
	・複合代入(+=,-=...)
	・インクリメント、デクリメント(++,--)
	・ビット演算(|,&)
	・オブジェクト生成(new)


## テンプレートシンタックス
### {{}}：片方向データバインド
- 式の値を文字列として出力する

### [(ngModel)]="変数"
- データ入力の値とコンポーネントクラスの変数の値が同期する  
※入力機能をもつHTML要素(inputタグなど)にのみ記述可能。双方向処理のため右辺と左辺を入れ替えても成り立つ式しか設定できないため、[(ngModel)]="変数 * 3" のような記述はできない

### リストの表示(*ngForディレクティブ)
- `*ngFor="let 一時変数 of 配列データ; let インデックス変数=index"`
- 配列データからインデックスの昇順に要素を取り出し、ngForを記述したHTML要素を繰り返し出力する。要素の値は一時変数、インデックスはインデックス変数から取得できる。
- 大量の表示データの一部のみ変更して再表示する場合は、`trackBy`パラメータの指定で高速化できる。  
詳細：https://angular.io/docs/ts/latest/guide/template-syntax.html#ngfortrackby

### HTML要素の表示・非表示(ngIfディレクティブ)
- `*ngIf=式`
- 式の値が `true`の時は指定したHTML要素を出力する
- 式の値が `false`の時は指定したHTML要素が削除される

- HTML要素の表示切り替え(ngSwitchディレクティブ)
- [ngSwitch]=式  
	*ngSwitchCase="'case1'"
	*ngSwitchDefault  
例）  
```
// value = 'case2' の時
<div [ngSwitch]="value">
  <div *ngSwitchCase="'case1'">赤</div>
  <div *ngSwitchCase="'case2'">黄色</div>
  <div *ngSwitchDefault>緑</div>
</div>
------- 出力結果 -------
<div>
  <div>黄色</div>
</div>
```

### HTML要素の表示切り替え
- `[プロパティ名]="式"`
- 指定したプロパティにしきの値を代入する
- プロパティで指定できない属性については、`[attr.属性名]="式"`を使用する
```
// isDisabled = true の時
<button [disabled]="isDisabled">保存</button>
------- 結果 -------
ボタン操作は無効
```
```
// img01="image1.jpg" の時
<img [src]="img01">
------- 結果 -------
image1.jpgの画像を表示 
```

### CSSクラスの追加・削除
- `[class.クラス名]`
- 式の値が`true`の時は指定クラスの追加、`false`の時は指定クラスの削除
```
// isActive = true の時
<div [class.myClass]="isActive">Hello</div>
------- 出力結果 -------
<div class="myClass">Hello</div>
```
```
// isActive = false の時
<div [class.myClass]="isActive">Hello</div>
------- 出力結果 -------
<div>Hello</div>
```

### CSSクラスの複数追加
- `[ngClass]="式"`
- 指定した複数のクラスを追加する
```
myClass = {
	largeText: true,
	infoColor: true,
	solidFrame: false
} の時

<div [ngClass]="myClass">Hello!</div>

------- 出力結果 -------
<div class="infoColor largeText">Hello!</div>
```

### CSSスタイルの指定
- `[style.プロパティ名]="式"`
- 指定したスタイルのプロパティを指定する
```
// value = bold の時
 <div [style.font-weight]="value">Hello World!</div>

 ------- 出力結果 -------
 <div style="font-weight:bold">Hello World!</div>
```

### CSSスタイルの複数指定
- `[ngStyle]="式"`
- 複数のスタイルを指定
```
<!--someStyles = {
		'font-size': '18px',
		'text-align': 'center',
		'color': '#00f'
} -->

<div [ngStyle]="someStyles">Hello World!</div>

------- 出力結果 -------
Hello World! (文字大きさ18px/中央揃え/青文字)
```

### イベント処理
- `(イベント名)="式"`
- 式の引数に `$event変数`を指定すると`イベントオブジェクト`を受け取れる
```
<button (click)="save($event)">保存</button>

// 結果
保存ボタンを押すとsave()メソッドが実行される
```

### HTML要素の参照取得
- #変数名
- 「テンプレート参照変数(Template Reference Variable)」HTML要素の参照を変数に代入する  
この変数を使って、該当要素のメソッド呼び出しやプロパティの取得ができる  
※コンポーネントクラスで定義が不要で、テンプレート内で独自に定義できる
```
<form method="post" action="/auth" #loginFormElement> // -----------------①
	<input type="text" name="userId">
	<input type="password" name="password">
	<button type="submit" (click)="loginFormElement.submit()"> // --------②
		ログイン
	</button>
</form>

// 解説
①#loginFormElementでform要素の参照を取得する
②loginFormElement.submit()でformをsubmitする
```

### パイプ
```
// value = "abc"の時
// Angular組み込みパイプUpperCasePipeをつかう
{{value | uppercase}}

// 結果
ABC
```

### プロパティ未定義エラーの回避
- オブジェクト名?.プロパティ名
- 「safe navigation operator」と呼ばれ、指定したプロパティやオブジェクトが未定義の場合でもエラーが発生しない
```
// 変数objが未定義
{{obj.length}}

// 結果
エラー
ーーーーーーーーーーーーーーーーーーーー

// 変数objが未定義
{{obj?.length}}

// 結果
何も起こらない
```

### ngOnInit
- `ngOnInit`
- コンポーネント初期化時完了時に呼び出されるメソッド

## Angularアプリの構成要素
### 構成要素
1. コンポーネント
ブラウザに表示するHTMLを出力する  
内部3つの構成要素
	- 処理定義：データ処理を行う。TypeScriptのimport文やAngularの独自機能であるDI(依存性の注入：Dependency Injection)を使いクラスなどを取り込んで利用する。処理の結果はHTMLテンプレートを使って出力する。
	- HTMLテンプレート：HTMLの動的生成を行う。ディレクティブや別のコンポーネント、パイプを取り込むことができる。HTMLとテンプレートシンタックスを組み合わせて記述する。
	- CSS：標準のCSSと同じだが、他のコンポーネントに影響を与えないようにカプセル化が行われる。
2. ディレクティブ
HTMLテンプレートに記述して、HTMLの出力や加工をする。  
ディレクティブには2種類ある。
	- `構造ディレクティブ(Structural Derective)`  
	HTMLの追加・消去
	- `属性ディレクティブ(Attribute Derective)`  
	HTMLのスタイルなどを変更する。  
	
	よく使われるディレクティブとしてHTMLを表示・消去を切り替える`ngIfディレクティブ`や配列データから表やリストなどのHTMLを繰り返し生成する`ngForディレクティブ`がある

3. DI(依存性の注入)
コンストラクタに仮引数を指定すると、そのインスタンスを取得できる仕組み

4. サービス
アプリの共通処理を行う。通常はDI可能なクラスとして作成する。

5. パイプ
データ変換を行う。  
例)数字出力に、3桁ごとにカンマをつけて桁数を読みやすくする など

6. ルーター
画面表示に仕様するコンポーネントを切り替える

7. クラス・インターフェース
TypeScriptのimport文で外部ライブラリなどをインポートする。

### 構成要素の登録
|プロパティ|設定内容|  
|:----------|:----------|
|declarations|コンポーネント、ディレクティブ、パイプ|
|imports|他の＠NgModuleで定義されたモジュール|
|providers|DI元のクラス|
|bootstrap|最初に呼び出すコンポーネント|







